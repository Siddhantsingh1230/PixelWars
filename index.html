<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Pixel Wars</title>
    <style type="text/css" media="all">
      * {
        margin: 0px;
        padding: 0px;
      }
      body {
        overflow: hidden;
      }
      canvas {
        background-color: white;
      }
      #score {
        position: fixed;
        bottom: 3vh;
        left: 4vh;
        font-size: 4.5vh;
        font-family: Monospace;
        font-weight: bold;
        color: black;
      }
      #dot {
        position: fixed;
        top: 2vh;
        right: 3vh;
        height: 8vw;
        width: 8vw;
        border-radius: 50%;
        background-color: black;
      }
      #start,
      #dot,
      canvas,
      #score {
        transition: all 1.2s ease;
      }
      #start {
        position: absolute;
        top: 50vh;
        left: 50vw;
        border-radius: 3.5vw;
        transform: translate(-50%, -50%);
        font-size: 2.5vh;
        font-family: Sans-Serif;
        font-weight: bold;
        color: white;
        padding: 12px;
        
        background: black;
        animation: startAnime 0.8s ease;
      }
      @keyframes startAnime{
        0%{
          top: -20px;
          filter: blur(5px);
        }
        
      }
    </style>
  </head>
  <body>
    <div id="score">0</div>
    <div id="dot"></div>
    <div id="start">Start Game</div>
    <canvas id="canvas"></canvas>
    <script type="text/javascript" charset="utf-8">
      let canvas = document.getElementById("canvas");
      let dot = document.getElementById("dot");
      let score = document.getElementById("score");
      let start = document.getElementById("start");
      let ctx = canvas.getContext("2d");
      canvas.width = innerWidth;
      canvas.height = innerHeight;
      //Universal Declarations
      let flag = 0;
      let scorevalue = 0;
      let PosX = innerWidth / 2;
      let PosY = innerHeight / 2;
      let spawnTime = 1000;
      let spawnCount = 0;
      //Enemy Speed Control
      let enemySpeed = 1;
      function randomColor() {
        let colorStr = Math.random() * 255;
        return colorStr;
      }
      dot.addEventListener("click", function () {
        if (flag == 0) {
          dot.style.background = "white";
          score.style.color = "white";
          canvas.style.background = "black";
          start.style.background = "white";
          start.style.color = "black";
          flag = 1;
        } else {
          dot.style.background = "black";
          score.style.color = "black";
          canvas.style.background = "white ";
          start.style.background = "black";
          start.style.color = "white";
          flag = 0;
        }
      });
      start.addEventListener("click", function () {
        start.style.display = "none";
        animate();
        spawnEnemy();
      });

      //Model Section
      class Player {
        constructor(x, y, r, c) {
          this.x = x;
          this.y = y;
          this.radius = r;
          this.color = c;
        }
        draw() {
          ctx.beginPath();
          ctx.fillStyle = this.color;
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
          ctx.fill();
        }
      }
      class Bullet {
        constructor(x, y, r, c, v, s) {
          this.x = x;
          this.y = y;
          this.radius = r;
          this.color = c;
          this.velocity = v;
          this.speed = s;
        }
        draw() {
          ctx.beginPath();
          ctx.fillStyle = this.color;
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
          ctx.fill();
        }
        //control bullet Movements
        move() {
          this.draw();
          this.x += this.speed * this.velocity.x;
          this.y += this.speed * this.velocity.y;
        }
      }
      class Enemy {
        constructor(x, y, r, c, v, s) {
          this.x = x;
          this.y = y;
          this.radius = r;
          this.color = c;
          this.velocity = v;
          this.speed = s;
        }
        draw() {
          ctx.beginPath();
          ctx.fillStyle = this.color;
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
          ctx.fill();
        }
        //control Enemy Movements
        move() {
          this.draw();
          this.x += this.speed * this.velocity.x;
          this.y += this.speed * this.velocity.y;
        }
      }
      let player = new Player(PosX, PosY, 20, "lightskyblue");
      //Bullet Instances
      let bullets = [];
      //Enemy Instances
      let enemies = [];
      //enemy creation every 1s
      function spawnEnemy() {
        setInterval(function () {
          spawnCount++;
          let ypos;
          let xpos;
          let radius = Math.random() * (20 - 10) + 10;
          let color =
            "rgb(" +
            randomColor() +
            "," +
            randomColor() +
            "," +
            randomColor() +
            ")";

          if (Math.random() <= 0.5) {
            if (Math.random() <= 0.5) {
              xpos = -2 * radius;
              ypos = Math.random() * innerHeight;
            } else {
              xpos =
                Math.random() * (2 * radius + innerWidth - innerWidth) +
                innerWidth;
              ypos = Math.random() * innerHeight;
            }
          } else {
            if (Math.random() <= 0.5) {
              ypos = -2 * radius;
              xpos = Math.random() * innerWidth;
            } else {
              ypos =
                Math.random() * (2 * radius + innerHeight - innerHeight) +
                innerHeight;
              xpos = Math.random() * innerWidth;
            }
          }

          let angle = Math.atan2(
            canvas.height / 2 - ypos,
            canvas.width / 2 - xpos
          );
          let veloX = Math.cos(angle);
          let veloY = Math.sin(angle);
          let velocity = {
            x: veloX,
            y: veloY,
          };
          enemies.push(
            new Enemy(xpos, ypos, radius, color, velocity, enemySpeed)
          );
          //SpeedTime Control
          if (spawnCount % 2 == 0) {
            enemySpeed *= 1.025;
          }
        }, spawnTime);
      }
      
      //Game Frames
      function animate() {
        console.log(bullets.length);
        ctx.clearRect(0, 0, innerWidth, innerHeight);
        let animeId = requestAnimationFrame(animate);
        player.draw();
        bullets.forEach((bullet, bulletindex) => {
          bullet.move();
          if (bullet.x + bullet.radius < 0 || bullet.x - bullet.radius >innerWidth || bullet.y + bullet.radius < 0 || bullet.y - bullet.radius >innerHeight ) {
            setTimeout(function () {
              bullets.splice(bulletindex, 1);
            }, 0);
          }
        });
        enemies.forEach((enemy, index) => {
          enemy.move();
          let d = Math.hypot(player.x - enemy.x, player.y - enemy.y);

          if (d - enemy.radius - player.radius < 1) {
            cancelAnimationFrame(animeId);
            let ask = confirm("<- Play Again ->");
            if (ask) {
              location.reload();
            }
          }
          bullets.forEach((bullet, bulletindex) => {
            let d = Math.hypot(bullet.x - enemy.x, bullet.y - enemy.y);

            if (d - enemy.radius - bullet.radius < 1) {
              scorevalue++;
              score.innerHTML = scorevalue;
              setTimeout(function () {
                enemies.splice(index, 1);
                bullets.splice(bulletindex, 1);
              }, 0);
            }
          });
        });
      }

      //Touch or Click X and Y position
      addEventListener("click", (e) => {
        let angle = Math.atan2(
          e.clientY - canvas.height / 2,
          e.clientX - canvas.width / 2
        );
        let bulletVelocity = {
          x: Math.cos(angle),
          y: Math.sin(angle),
        };
        bullets.push(new Bullet(PosX, PosY, 5, "deeppink", bulletVelocity, 5));
      });
    </script>
  </body>
</html>
